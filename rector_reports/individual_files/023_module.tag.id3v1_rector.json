{
  "file_path": "selected_100_files\\medium_201_500\\023_module.tag.id3v1.php",
  "rector_analysis": {
    "php_version_changes": 6,
    "rules_triggered": [
      "Rector\\Php54\\Rector\\Array_\\LongArrayToShortArrayRector",
      "Rector\\Php70\\Rector\\Ternary\\TernaryToNullCoalescingRector",
      "Rector\\Php74\\Rector\\ArrayDimFetch\\CurlyToSquareBracketArrayStringRector",
      "Rector\\Php80\\Rector\\Identical\\StrStartsWithRector",
      "Rector\\Php80\\Rector\\Switch_\\ChangeSwitchToMatchRector",
      "Rector\\Php81\\Rector\\FuncCall\\NullToStrictStringFuncCallArgRector"
    ],
    "changes_by_php_version": {
      "php_54": 1,
      "php_70": 1,
      "php_74": 1,
      "php_80": 2,
      "php_81": 1
    },
    "has_diff": true,
    "diff_line_count": 136
  },
  "analysis_metadata": {
    "rector_version": "2.1.0",
    "analysis_date": "2025-08-31T05:19:04.139602",
    "file_size_kb": 11.3,
    "analysis_type": "version_specific_only"
  },
  "raw_rector_output": {
    "totals": {
      "changed_files": 1,
      "errors": 0
    },
    "file_diffs": [
      {
        "file": "selected_100_files/medium_201_500/023_module.tag.id3v1.php",
        "diff": "--- Original\n+++ New\n@@ -29,22 +29,22 @@\n \t\t$preid3v1 = fread($this->getid3->fp, 128);\n \t\t$id3v1tag = fread($this->getid3->fp, 128);\n \n-\t\tif (substr($id3v1tag, 0, 3) == 'TAG') {\n+\t\tif (str_starts_with((string) $id3v1tag, 'TAG')) {\n \n \t\t\t$info['avdataend'] = $info['filesize'] - 128;\n \n-\t\t\t$ParsedID3v1['title']   = $this->cutfield(substr($id3v1tag,   3, 30));\n-\t\t\t$ParsedID3v1['artist']  = $this->cutfield(substr($id3v1tag,  33, 30));\n-\t\t\t$ParsedID3v1['album']   = $this->cutfield(substr($id3v1tag,  63, 30));\n-\t\t\t$ParsedID3v1['year']    = $this->cutfield(substr($id3v1tag,  93,  4));\n-\t\t\t$ParsedID3v1['comment'] =                 substr($id3v1tag,  97, 30);  // can't remove nulls yet, track detection depends on them\n-\t\t\t$ParsedID3v1['genreid'] =             ord(substr($id3v1tag, 127,  1));\n+\t\t\t$ParsedID3v1['title']   = $this->cutfield(substr((string) $id3v1tag,   3, 30));\n+\t\t\t$ParsedID3v1['artist']  = $this->cutfield(substr((string) $id3v1tag,  33, 30));\n+\t\t\t$ParsedID3v1['album']   = $this->cutfield(substr((string) $id3v1tag,  63, 30));\n+\t\t\t$ParsedID3v1['year']    = $this->cutfield(substr((string) $id3v1tag,  93,  4));\n+\t\t\t$ParsedID3v1['comment'] =                 substr((string) $id3v1tag,  97, 30);  // can't remove nulls yet, track detection depends on them\n+\t\t\t$ParsedID3v1['genreid'] =             ord(substr((string) $id3v1tag, 127,  1));\n \n \t\t\t// If second-last byte of comment field is null and last byte of comment field is non-null\n \t\t\t// then this is ID3v1.1 and the comment field is 28 bytes long and the 30th byte is the track number\n-\t\t\tif (($id3v1tag{125} === \"\\x00\") && ($id3v1tag{126} !== \"\\x00\")) {\n-\t\t\t\t$ParsedID3v1['track']   = ord(substr($ParsedID3v1['comment'], 29,  1));\n-\t\t\t\t$ParsedID3v1['comment'] =     substr($ParsedID3v1['comment'],  0, 28);\n+\t\t\tif (($id3v1tag[125] === \"\\x00\") && ($id3v1tag[126] !== \"\\x00\")) {\n+\t\t\t\t$ParsedID3v1['track']   = ord(substr((string) $ParsedID3v1['comment'], 29,  1));\n+\t\t\t\t$ParsedID3v1['comment'] =     substr((string) $ParsedID3v1['comment'],  0, 28);\n \t\t\t}\n \t\t\t$ParsedID3v1['comment'] = $this->cutfield($ParsedID3v1['comment']);\n \n@@ -81,7 +81,7 @@\n \t\t\t$info['id3v1'] = $ParsedID3v1;\n \t\t}\n \n-\t\tif (substr($preid3v1, 0, 3) == 'TAG') {\n+\t\tif (str_starts_with((string) $preid3v1, 'TAG')) {\n \t\t\t// The way iTunes handles tags is, well, brain-damaged.\n \t\t\t// It completely ignores v1 if ID3v2 is present.\n \t\t\t// This goes as far as adding a new v1 tag *even if there already is one*\n@@ -88,9 +88,9 @@\n \n \t\t\t// A suspected double-ID3v1 tag has been detected, but it could be that\n \t\t\t// the \"TAG\" identifier is a legitimate part of an APE or Lyrics3 tag\n-\t\t\tif (substr($preid3v1, 96, 8) == 'APETAGEX') {\n+\t\t\tif (substr((string) $preid3v1, 96, 8) == 'APETAGEX') {\n \t\t\t\t// an APE tag footer was found before the last ID3v1, assume false \"TAG\" synch\n-\t\t\t} elseif (substr($preid3v1, 119, 6) == 'LYRICS') {\n+\t\t\t} elseif (substr((string) $preid3v1, 119, 6) == 'LYRICS') {\n \t\t\t\t// a Lyrics3 tag footer was found before the last ID3v1, assume false \"TAG\" synch\n \t\t\t} else {\n \t\t\t\t// APE and Lyrics3 footers not found - assume double ID3v1\n@@ -103,11 +103,11 @@\n \t}\n \n \tpublic static function cutfield($str) {\n-\t\treturn trim(substr($str, 0, strcspn($str, \"\\x00\")));\n+\t\treturn trim(substr((string) $str, 0, strcspn((string) $str, \"\\x00\")));\n \t}\n \n \tpublic static function ArrayOfGenres($allowSCMPXextended=false) {\n-\t\tstatic $GenreLookup = array(\n+\t\tstatic $GenreLookup = [\n \t\t\t0    => 'Blues',\n \t\t\t1    => 'Classic Rock',\n \t\t\t2    => 'Country',\n@@ -261,9 +261,9 @@\n \n \t\t\t'CR' => 'Cover',\n \t\t\t'RX' => 'Remix'\n-\t\t);\n+\t\t];\n \n-\t\tstatic $GenreLookupSCMPX = array();\n+\t\tstatic $GenreLookupSCMPX = [];\n \t\tif ($allowSCMPXextended && empty($GenreLookupSCMPX)) {\n \t\t\t$GenreLookupSCMPX = $GenreLookup;\n \t\t\t// http://www.geocities.co.jp/SiliconValley-Oakland/3664/alittle.html#GenreExtended\n@@ -303,7 +303,7 @@\n \t\t\t\tbreak;\n \t\t}\n \t\t$GenreLookup = self::ArrayOfGenres($allowSCMPXextended);\n-\t\treturn (isset($GenreLookup[$genreid]) ? $GenreLookup[$genreid] : false);\n+\t\treturn ($GenreLookup[$genreid] ?? false);\n \t}\n \n \tpublic static function LookupGenreID($genre, $allowSCMPXextended=false) {\n@@ -326,12 +326,12 @@\n \n \tpublic static function GenerateID3v1Tag($title, $artist, $album, $year, $genreid, $comment, $track='') {\n \t\t$ID3v1Tag  = 'TAG';\n-\t\t$ID3v1Tag .= str_pad(trim(substr($title,  0, 30)), 30, \"\\x00\", STR_PAD_RIGHT);\n-\t\t$ID3v1Tag .= str_pad(trim(substr($artist, 0, 30)), 30, \"\\x00\", STR_PAD_RIGHT);\n-\t\t$ID3v1Tag .= str_pad(trim(substr($album,  0, 30)), 30, \"\\x00\", STR_PAD_RIGHT);\n-\t\t$ID3v1Tag .= str_pad(trim(substr($year,   0,  4)),  4, \"\\x00\", STR_PAD_LEFT);\n+\t\t$ID3v1Tag .= str_pad(trim(substr((string) $title,  0, 30)), 30, \"\\x00\", STR_PAD_RIGHT);\n+\t\t$ID3v1Tag .= str_pad(trim(substr((string) $artist, 0, 30)), 30, \"\\x00\", STR_PAD_RIGHT);\n+\t\t$ID3v1Tag .= str_pad(trim(substr((string) $album,  0, 30)), 30, \"\\x00\", STR_PAD_RIGHT);\n+\t\t$ID3v1Tag .= str_pad(trim(substr((string) $year,   0,  4)),  4, \"\\x00\", STR_PAD_LEFT);\n \t\tif (!empty($track) && ($track > 0) && ($track <= 255)) {\n-\t\t\t$ID3v1Tag .= str_pad(trim(substr($comment, 0, 28)), 28, \"\\x00\", STR_PAD_RIGHT);\n+\t\t\t$ID3v1Tag .= str_pad(trim(substr((string) $comment, 0, 28)), 28, \"\\x00\", STR_PAD_RIGHT);\n \t\t\t$ID3v1Tag .= \"\\x00\";\n \t\t\tif (gettype($track) == 'string') {\n \t\t\t\t$track = (int) $track;\n@@ -338,20 +338,15 @@\n \t\t\t}\n \t\t\t$ID3v1Tag .= chr($track);\n \t\t} else {\n-\t\t\t$ID3v1Tag .= str_pad(trim(substr($comment, 0, 30)), 30, \"\\x00\", STR_PAD_RIGHT);\n+\t\t\t$ID3v1Tag .= str_pad(trim(substr((string) $comment, 0, 30)), 30, \"\\x00\", STR_PAD_RIGHT);\n \t\t}\n \t\tif (($genreid < 0) || ($genreid > 147)) {\n \t\t\t$genreid = 255; // 'unknown' genre\n \t\t}\n-\t\tswitch (gettype($genreid)) {\n-\t\t\tcase 'string':\n-\t\t\tcase 'integer':\n-\t\t\t\t$ID3v1Tag .= chr(intval($genreid));\n-\t\t\t\tbreak;\n-\t\t\tdefault:\n-\t\t\t\t$ID3v1Tag .= chr(255); // 'unknown' genre\n-\t\t\t\tbreak;\n-\t\t}\n+\t\tmatch (gettype($genreid)) {\n+            'string', 'integer' => $ID3v1Tag .= chr(intval($genreid)),\n+            default => $ID3v1Tag .= chr(255),\n+        };\n \n \t\treturn $ID3v1Tag;\n \t}\n",
        "applied_rectors": [
          "Rector\\Php54\\Rector\\Array_\\LongArrayToShortArrayRector",
          "Rector\\Php70\\Rector\\Ternary\\TernaryToNullCoalescingRector",
          "Rector\\Php74\\Rector\\ArrayDimFetch\\CurlyToSquareBracketArrayStringRector",
          "Rector\\Php80\\Rector\\Identical\\StrStartsWithRector",
          "Rector\\Php80\\Rector\\Switch_\\ChangeSwitchToMatchRector",
          "Rector\\Php81\\Rector\\FuncCall\\NullToStrictStringFuncCallArgRector"
        ]
      }
    ],
    "changed_files": [
      "selected_100_files/medium_201_500/023_module.tag.id3v1.php"
    ]
  }
}